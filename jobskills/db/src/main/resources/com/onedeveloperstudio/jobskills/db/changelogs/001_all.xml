<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd"
    objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
  <changeSet author="y.zakharov" id="1">
    <comment>
      Если база поддерживает sequence, то hiber его использует по умолчанию. Один на все таблицы.
      При этом для каждой autoIncrement колонки будет создан свой sequence, который нигде не будет использоваться, и
      черт бы с ними.
    </comment>
    <createSequence sequenceName="hibernate_sequence"/>
    <createTable tableName="useraccount">
      <column autoIncrement="true" name="id" type="BIGINT">
        <constraints nullable="false" primaryKey="true" primaryKeyName="PKB3F13C2D1B"/>
      </column>
      <column name="username" type="VARCHAR(100)">
        <constraints nullable="false"/>
      </column>
      <column name="password" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="email" type="VARCHAR(30)">
        <constraints nullable="false"/>
      </column>
      <column name="userfullname" type="VARCHAR(100)"/>
      <column name="sex" type="VARCHAR(1)"/>
      <column name="birthday" type="TIMESTAMP"/>
      <column name="phone" type="VARCHAR(20)"/>
      <column name="city" type="VARCHAR(30)"/>
      <column name="country" type="VARCHAR(30)"/>
      <column name="network" type="VARCHAR(20)"/>
    </createTable>
    <createTable tableName="commentary">
      <column autoIncrement="true" name="id" type="BIGINT">
        <constraints primaryKey="true" primaryKeyName="PKUK_hio9iw7irkbdbw7ccy01i9bhm"/>
      </column>
      <column name="adddate" type="TIMESTAMP">
        <constraints nullable="false"/>
      </column>
      <column name="message" type="VARCHAR(1000)">
        <constraints nullable="false"/>
      </column>
      <column name="author_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="head_id" type="BIGINT"/>
    </createTable>
    <createTable tableName="commentary_vote">
      <column name="commentary_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="votes_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createTable tableName="dashboard">
      <column autoIncrement="true" name="id" type="BIGINT">
        <constraints primaryKey="true" primaryKeyName="PKUK_ev8wiiub09rwnfijowl1nw9fk"/>
      </column>
      <column name="date" type="TIMESTAMP"/>
      <column name="hours" type="INT"/>
      <column name="minutes" type="INT"/>
      <column name="user_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="way_id" type="BIGINT"/>
    </createTable>
    <createTable tableName="vote">
      <column autoIncrement="true" name="id" type="BIGINT">
        <constraints primaryKey="true" primaryKeyName="PKUK_trhlgsrr6yksn99pocmg1dyww"/>
      </column>
      <column name="state" type="INT"/>
      <column name="votedate" type="TIMESTAMP"/>
      <column name="user_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createTable tableName="jobs">
      <column autoIncrement="true" name="id" type="BIGINT">
        <constraints primaryKey="true" primaryKeyName="PKUK_d5jvetnyjk6j7nicxla1uh5cr"/>
      </column>
      <column name="caption" type="VARCHAR(200)">
        <constraints nullable="false"/>
      </column>
      <column name="description" type="VARCHAR(1000)">
        <constraints nullable="false"/>
      </column>
      <column name="parent_id" type="BIGINT"/>
    </createTable>
    <createTable tableName="requiredskill">
      <column autoIncrement="true" name="id" type="BIGINT">
        <constraints primaryKey="true" primaryKeyName="PKUK_51xc14a8fmomoem3w31l6i95m"/>
      </column>
      <column name="caption" type="VARCHAR(200)">
        <constraints nullable="false"/>
      </column>
      <column name="description" type="VARCHAR(1000)">
        <constraints nullable="false"/>
      </column>
      <column name="job_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createTable tableName="requiredskill_commentary">
      <column name="requiredskill_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="comments_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createTable tableName="requiredskill_waytoimproveskill">
      <column name="skill_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="ways_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createTable tableName="requiredskill_votes">
      <column name="skill_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="vote_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <createTable tableName="waytoimproveskill">
      <column autoIncrement="true" name="id" type="BIGINT">
        <constraints primaryKey="true" primaryKeyName="PKUK_f91vrgeu74xuv2h9vjag6bsye"/>
      </column>
      <column name="adddate" type="TIMESTAMP">
        <constraints nullable="false"/>
      </column>
      <column name="caption" type="VARCHAR(512)">
        <constraints nullable="false"/>
      </column>
      <column name="description" type="VARCHAR(1000)">
        <constraints nullable="false"/>
      </column>
      <column name="grade" type="VARCHAR(100)"/>
      <column name="link" type="VARCHAR(255)"/>
      <column name="resourceType" type="VARCHAR(100)"/>
    </createTable>
    <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="vote"
                             constraintName="FK_2GXKGPKS02ISJNRFYQQ3ALD61" referencedColumnNames="id"
                             referencedTableName="useraccount"/>
    <addForeignKeyConstraint baseColumnNames="commentary_id" baseTableName="commentary_vote"
                             constraintName="FK_7NLIKSRLGOV83VLD4M3F58NXF" referencedColumnNames="id"
                             referencedTableName="commentary"/>
    <addForeignKeyConstraint baseColumnNames="votes_id" baseTableName="commentary_vote"
                             constraintName="FK_AE6U9QCNCO0QTFCBR385UAPM3" referencedColumnNames="id"
                             referencedTableName="vote"/>
    <addForeignKeyConstraint baseColumnNames="way_id" baseTableName="dashboard"
                             constraintName="FK_CSC3OU4EK2Y1GDWVLA8HJ2GJ6" referencedColumnNames="id"
                             referencedTableName="waytoimproveskill"/>
    <addForeignKeyConstraint baseColumnNames="skill_id" baseTableName="requiredskill_waytoimproveskill"
                             constraintName="FK_D0141GLM8VX5WAHVM2X1XIJ4P" referencedColumnNames="id"
                             referencedTableName="waytoimproveskill"/>
    <addForeignKeyConstraint baseColumnNames="head_id" baseTableName="commentary"
                             constraintName="FK_E3EYNFFOHOKTU4FM4X1S5YLHU" referencedColumnNames="id"
                             referencedTableName="commentary"/>
    <addForeignKeyConstraint baseColumnNames="job_id" baseTableName="requiredskill"
                             constraintName="FK_EDMDYX9VCQSD9YO63RBO5IX9D" referencedColumnNames="id"
                             referencedTableName="jobs"/>
    <addForeignKeyConstraint baseColumnNames="ways_id" baseTableName="requiredskill_waytoimproveskill"
                             constraintName="FK_FGG7QR4047MN2W2TMHFPMQB26" referencedColumnNames="id"
                             referencedTableName="requiredskill"/>
    <addForeignKeyConstraint baseColumnNames="requiredskill_id" baseTableName="requiredskill_commentary"
                             constraintName="FK_G597SOJGQSNFQY02UTL72KMA" referencedColumnNames="id"
                             referencedTableName="requiredskill"/>
    <addForeignKeyConstraint baseColumnNames="parent_id" baseTableName="jobs"
                             constraintName="FK_GAQ124TOVS1BLUP6GLKBJIFWS" referencedColumnNames="id"
                             referencedTableName="jobs"/>
    <addForeignKeyConstraint baseColumnNames="comments_id" baseTableName="requiredskill_commentary"
                             constraintName="FK_L3A01U0R12LUW99YOA51HV5XX" referencedColumnNames="id"
                             referencedTableName="commentary"/>
    <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="dashboard"
                             constraintName="FK_P1J93SCAK65C45SA4V6WVU7CS" referencedColumnNames="id"
                             referencedTableName="useraccount"/>
    <addForeignKeyConstraint baseColumnNames="author_id" baseTableName="commentary"
                             constraintName="FK_PE1CR7GHULATF2FONYAGBFJLN" referencedColumnNames="id"
                             referencedTableName="useraccount"/>
    <addUniqueConstraint columnNames="votes_id" constraintName="UK_AE6U9QCNCO0QTFCBR385UAPM3"
                         tableName="commentary_vote"/>
    <addUniqueConstraint columnNames="comments_id" constraintName="UK_L3A01U0R12LUW99YOA51HV5XX"
                         tableName="requiredskill_commentary"/>
  </changeSet>

  <changeSet id="002" author="y.zakharov">
    <createTable tableName="news">
      <column autoIncrement="true" name="id" type="BIGINT">
        <constraints primaryKey="true" primaryKeyName="PKUK_NEWSPK"/>
      </column>
      <column name="adddate" type="TIMESTAMP">
        <constraints nullable="false"/>
      </column>
      <column name="caption" type="VARCHAR(200)">
        <constraints nullable="false"/>
      </column>
      <column name="body" type="VARCHAR(4000)"/>
      <column name="author_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="link" type="VARCHAR(150)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint baseColumnNames="author_id" baseTableName="news"
                             constraintName="FK_NEWS_USERACCOUNT" referencedColumnNames="id"
                             referencedTableName="useraccount"/>
    <createTable tableName="news_commentary">
      <column name="news_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="commentary_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint baseColumnNames="news_id" baseTableName="news_commentary"
                             constraintName="FK_NEWS_news_commentary" referencedColumnNames="id"
                             referencedTableName="news"/>
    <addForeignKeyConstraint baseColumnNames="commentary_id" baseTableName="news_commentary"
                             constraintName="FK_COMMENTARY_news_commentary" referencedColumnNames="id"
                             referencedTableName="commentary"/>

    <createTable tableName="news_votes">
      <column name="news_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="vote_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint baseColumnNames="news_id" baseTableName="news_votes"
                             constraintName="FK_NEWS_news_votes" referencedColumnNames="id"
                             referencedTableName="news"/>
    <addForeignKeyConstraint baseColumnNames="vote_id" baseTableName="news_votes"
                             constraintName="FK_COMMENTARY_news_votes" referencedColumnNames="id"
                             referencedTableName="vote"/>
  </changeSet>

  <changeSet author="y.zakharov" id="003">
    <createTable tableName="waytoimproveskill_votes">
      <column name="waytoimproveskill_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="vote_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint baseColumnNames="waytoimproveskill_id" baseTableName="waytoimproveskill_votes"
                             constraintName="FK_waytoimproveskill_votes" referencedColumnNames="id"
                             referencedTableName="waytoimproveskill"/>
    <addForeignKeyConstraint baseColumnNames="vote_id" baseTableName="waytoimproveskill_votes"
                             constraintName="FK_waytoimproveskill_votes_votes" referencedColumnNames="id"
                             referencedTableName="vote"/>
    <createTable tableName="waytoimproveskill_commentary">
      <column name="waytoimproveskill_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="commentary_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint baseColumnNames="waytoimproveskill_id" baseTableName="waytoimproveskill_commentary"
                             constraintName="FK_NEWS_news_commentary" referencedColumnNames="id"
                             referencedTableName="waytoimproveskill"/>
    <addForeignKeyConstraint baseColumnNames="commentary_id" baseTableName="waytoimproveskill_commentary"
                             constraintName="FK_COMMENTARY_news_commentary" referencedColumnNames="id"
                             referencedTableName="commentary"/>
  </changeSet>
</databaseChangeLog>